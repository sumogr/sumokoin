name: Continuous_Integration_Testing

on: [push, pull_request]

jobs:

  cross-build-linux-32bit-binaries-on-xenial:
    runs-on: windows-latest
    defaults:
     run:
      shell: wsl-bash {0} 
    steps:
    - name: use wsl
      uses: Vampire/setup-wsl@v1
      with:
          distribution: Ubuntu-20.04
    - name: checkout branch
      uses: actions/checkout@v1
    - name : update debian and install dependencies
      run: |
        sudo dpkg --add-architecture i386
        sudo apt-get update
        wget http://archive.ubuntu.com/ubuntu/pool/universe/b/boost-defaults/libboost-all-dev_1.71.0.0ubuntu2_i386.deb
        sudo dpkg --install libusb-dev_0.1.12-32_i386.deb
        sudo apt-get install libboost-all-dev:i386 g++-multilib gcc-multilib bc cmake git pkg-config libssl-dev:i386 libzmq3-dev libsodium-dev:i386 libunwind8-dev:i386 liblzma-dev libreadline6-dev libldns-dev libexpat1-dev doxygen graphviz libpgm-dev libhidapi-dev -y
        cd ..
        sudo chmod -R 777 sumokoin
        cd sumokoin
    - name: cross-compile sumokoin for linux i686
      run:  sudo make release-static -j 2
    - name: upload binaries      
      uses: actions/upload-artifact@v2
      with:
        name: Linux-i686-release-binaries
        path: build/**/bin/      
