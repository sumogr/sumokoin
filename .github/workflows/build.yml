name: Continuous_Integration_Testing

on: [push, pull_request]

jobs:
  cross-build-linux-32bit-binaries-on-xenial:
    runs-on: windows-latest
    defaults:
     run:
      shell: wsl-bash {0}
    steps:
    - name: use wsl
      uses: Vampire/setup-wsl@v1
      with:
          distribution: Ubuntu-20.04
          update: 'true'
          container: ubuntu:20.04  
    - name: checkout branch
      uses: actions/checkout@v1
    - name : install sumokoin dependencies and statically build sumokoin for i686
      run: |
        apt-get update -y
        DEBIAN_FRONTEND="noninteractive" apt-get -y install tzdata
        apt-get install wget g++-multilib gcc-multilib sudo cmake git curl pkg-config tar binutils -y
        cd contrib
        cd depends
        sudo chmod +x config.guess
        sudo chmod +x config.site.in
        sudo chmod +x config.sub
        sudo dos2unix config.guess
        sudo dos2unix config.site.in
        sudo dos2unix config.sub
        cd ..
        cd ..
        cd ..
        sudo chmod -R 777 sumokoin
        cd sumokoin
        export PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin        
        make depends target=i686-linux-gnu -j 4
    - name: upload binaries      
      uses: actions/upload-artifact@v2
      with:
        name: Linux-i686-release-binaries
        path: build/**/bin/   
              
        
